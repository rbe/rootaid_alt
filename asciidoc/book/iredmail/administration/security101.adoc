== Security 101

=== Firewall

You can edit firewall rules in `/etc/default/iptables`.
They were setup during iRedMail setup process and
I added SMTPS port 465 `-A INPUT -p tcp --dport 465 -j ACCEPT`:

[source,bash,linenums]
----
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

# Keep state.
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# Loop device.
-A INPUT -i lo -j ACCEPT

# Allow PING from remote hosts.
-A INPUT -p icmp --icmp-type echo-request -j ACCEPT

# ssh
-A INPUT -p tcp --dport 22 -j ACCEPT

# http, https
-A INPUT -p tcp --dport 80 -j ACCEPT
-A INPUT -p tcp --dport 443 -j ACCEPT

# smtp, submission
-A INPUT -p tcp --dport 25 -j ACCEPT
-A INPUT -p tcp --dport 465 -j ACCEPT
-A INPUT -p tcp --dport 587 -j ACCEPT

# pop3, pop3s
-A INPUT -p tcp --dport 110 -j ACCEPT
-A INPUT -p tcp --dport 995 -j ACCEPT

# imap, imaps
-A INPUT -p tcp --dport 143 -j ACCEPT
-A INPUT -p tcp --dport 993 -j ACCEPT

COMMIT
----

Take a look at `iptables -L -v -n`.

=== fail2ban

[source,bash,linenums]
.Show fail2ban status
----
fail2ban-client status
----

[source,bash,linenums]
.Show status of jail
----
fail2ban-client status postfix-iredmail
----

[source,bash,linenums]
.Show all jail's status
----
/root/bin/fail2ban-jails-status
----

[source,bash,linenums]
.Unban an IP address with fail2ban-client
----
fail2ban-client set postfix-iredmail unbanip 84.150.74.210
----

[source,bash,linenums]
.Unban an IP from all jails
----
/root/bin/fail2ban-unban-all 84.150.74.210
----

=== SSL Certificates With letsencrypt.org

See https://letsencrypt.org/getting-started/[letsencrypt: Getting Started].

[source,bash,linenums]
.Install git
----
apt-get install -y git
----

[source,bash,linenums]
.Clone letsencrypt repository
----
cd /root
git clone https://github.com/letsencrypt/letsencrypt
----

[source,bash,linenums]
.Edit /root/.bashrc and include letsencrypt in your PATH
----
export PATH=$HOME/bin:$HOME/letsencrypt:$PATH
----

[source,bash,linenums]
.Start using letsencrypt
----
letsencrypt-auto --help
----
