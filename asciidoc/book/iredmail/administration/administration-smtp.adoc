=== SMTP Server Postfix

==== Users

[source]
.Show errors for a user
----
show-mail-errors 001@002.de
----

.Example output
----
Mar 20 13:15:17 <ralf@0xcafebabe.eu> => <ralf@bensmann.com>, Absender geh√∂rt ralf@0xcafebabe.eu nicht

Mar 25 16:22:05 <001@002.de> => <001@002.de>, unzureichendes HELO: need fully-qualified hostname
Mar 25 16:22:50 <001@002.de> => <001@002.de>, abgelehnt: client [79.247.148.34] blocked using zen.spamhaus.org
----

==== Mail Queue

[source]
.Monitor mail queue
----
monitor-mailq
----

.Example
----
root@mx:~# monitor-mailq
Monitoring mailq every 5 seconds, stop with Ctrl-C
858EB12030BCD5*    2620 Sat Mar 26 14:40:14  alice@example.com
95A521202AA0FC*   16816 Sat Mar 26 14:40:27  bob@example.com
----

[source]
.Show mail queue count
----
show-mailq-count
----

[source]
.Show mail queue contents
----
show-mailq-contents
----

[source]
.Delete entire mail queue
----
delete-mailq
----

[source]
.Hold all messages
----
postsuper -h ALL
----

[source]
.Show all hold messages
----
mailq | grep -E "[A-Z0-9]+\!"
----

[source]
.Delete all messages on hold
----
mailq | grep -E "[A-Z0-9]+\!" | awk '{print $1}' | tr -d '*!' | postsuper -d -
----

[source,bash,linenums]
----
mailq | grep -E "^[A-Z0-9]\w" | awk '{print $1}' > queueids
----

[source,bash,linenums]
----
mailq \
    | tail +2 \
    | grep -v '^ *(' \
    | awk  'BEGIN { RS = "" }
                  # $7=sender, $8=recipient1, $9=recipient2
                  { if ($8 == "user@example.com" && $9 == "") print $1 }' \
    | tr -d '*!' \
    | postsuper -d -
----
