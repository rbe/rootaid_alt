#!/bin/bash
### BEGIN INIT INFO  
# Provides:          wildfly810  
# Required-Start:    $local_fs $remote_fs $network $syslog  
# Required-Stop:     $local_fs $remote_fs $network $syslog  
# Default-Start:     2 3 4 5  
# Default-Stop:      0 1 6  
# Short-Description: Start/Stop WildFly 8.1.0
### END INIT INFO  
# chkconfig: 35 92 1  

## Include some script files in order to set and export environmental variables  
## as well as add the appropriate executables to $PATH.  
[ -r /etc/profile.d/java.sh ] && . /etc/profile.d/java.sh  
[ -r /etc/profile.d/jboss.sh ] && . /etc/profile.d/jboss.sh  

WILDFLY_HOME=/opt/wildfly-8.1.0.Final

WF8_OPTS="${WF8_OPTS} -Dorg.apache.tomcat.util.http.ServerCookie.ALLOW_HTTP_SEPARATORS_IN_V0=true"   ## See AS7-1625  
WF8_OPTS="${WF8_OPTS} -Djboss.bind.address.management=127.0.0.1"
WF8_OPTS="${WF8_OPTS} -Djboss.bind.address=127.0.0.1"

case "$1" in  
    start)  
        echo "Starting WildFly 8..."  
        sudo -u jboss sh ${WILDFLY_HOME}/bin/standalone.sh ${WF8_OPTS} 2>/var/log/wildfly.log 1>&2 & ##  If running as user "jboss"
        #start-stop-daemon --start --quiet --background --chuid jboss --exec ${WILDFLY_HOME}/bin/standalone.sh -- ${WF8_OPTS}   ## Ubuntu
        #${WILDFLY_HOME}/bin/standalone.sh ${WF8_OPTS} &  
    ;;  
    stop)  
        echo "Stopping WildFly 8..."  
        sudo -u jboss sh ${WILDFLY_HOME}/bin/jboss-cli.sh --connect controller=localhost:10000 command=:shutdown            ##  If running as user "jboss"
        #start-stop-daemon --start --quiet --background --chuid jboss --exec ${WILDFLY_HOME}/bin/jboss-cli.sh -- --connect command=:shutdown     ## Ubuntu
        #${WILDFLY_HOME}/bin/jboss-cli.sh --connect command=:shutdown  
    ;;  
    *)  
        echo "Usage: $0 { start | stop }"; exit 1;  
    ;;  
esac  

exit 0
